// Generated by CoffeeScript 1.7.1
(function() {
  $(document).ready(function() {
    var addChatters, askForNickname, collectMessage, insertMessage, socket;
    console.log("jQuery says document is ready.");
    insertMessage = function(data) {
      console.log('insertMessage() fired...');
      return $('<li class="entry row"><span class="chatter-name col-xs-3">' + data.nickname + '</span><span class="chat-content col-xs-8">' + data.message + '</span></li>').appendTo('#entries');
    };
    addChatters = function(data) {
      var status;
      console.log("updating chatters...");
      if (data.online) {
        status = 'online';
      } else {
        status = 'not-online';
      }
      return $("<li class='chatter row'><span class='chatter-name col-xs-12 " + status + "'>" + data.nickname + "</span></li>").appendTo('#chatters-list');
    };
    collectMessage = function() {
      var message;
      message = $('#chat-entry').val();
      console.log("chitchat: " + message);
      socket.emit('messages', message);
      return $("#chat-entry").val("");
    };
    askForNickname = function(data) {
      var nickname;
      console.log("asking user for name...");
      nickname = prompt('What\'s your name?');
      if (nickname !== null) {
        console.log("user set nickname: " + nickname);
        $('#status').html('Connected to Chitchat <span id="nickname">...</span>');
        socket.emit('join', nickname);
        $('#status #nickname').html("as <strong>" + nickname + "</strong>.");
      } else {
        return askForNickname(data);
      }
    };
    socket = io.connect('http://localhost');
    $('#chat-entry').keypress(function(e) {
      if (e.which === 13) {
        return collectMessage();
      }
    });
    $("#chitchat").on('click', function(e) {
      return collectMessage();
    });
    socket.on('messages', function(data) {
      return insertMessage(data);
    });
    socket.on('error', function(message) {
      return alert(message);
    });
    socket.on('chatters', function(data) {
      return addChatters(data);
    });
    socket.on('askForName', function(data) {
      return askForNickname(data);
    });
    return socket.on('connect', function(data) {
      return askForNickname(data);
    });
  });

}).call(this);
